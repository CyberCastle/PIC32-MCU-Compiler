version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: a1-standard-4
    os_image: macos-mojave-xcode11
execution_time_limit:
  hours: 20
blocks:
  - name: 'Block #1'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - rm -Rf /Applications/Firefox.app
            - rm -Rf /Applications/Google\ Chrome.app
            - rm -Rf ~/.rbenv
            - rm -Rf ~/.cocoapods
            - rm -Rf ~/.flutter
            - rm -Rf ~/.gradle
            - rm -Rf ~/flutter
            - rm -Rf ~/Library/Developer/CoreSimulator
            - xcversion select 11.3.1
            - rm -Rf /Applications/Xcode-11.2.1.app
            - rm -Rf /Applications/Xcode-11.4.1.app
            - checkout
            - ./compiler-build-osx.sh
      epilogue:
        on_pass:
          commands:
            - artifact push project ~/PIC32-MCU-Compiler/zips/pic32-tools-Compiler-2.40-Darwin-image.tar.gz
            - artifact push project ~/PIC32-MCU-Compiler/zips/pic32-tools-Compiler-2.40-Darwin-image.sha256
            - artifact push job --expire-in 2w ~/PIC32-MCU-Compiler/Compiler-2.40.log
        on_fail:
          commands:
            - artifact push job --expire-in 2w ~/PIC32-MCU-Compiler/Compiler-2.40.log
